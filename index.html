<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lista de Juegos</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>Lista de Juegos</h1>

    <ul id="roomsList">
        <!-- La lista de juegos se mostrará aquí -->
    </ul>

    <form id="joinForm" onsubmit="joinRoom(event)" style="display: none;">
        <input type="text" id="roomId" readonly required>
        <label for="playerNameJoin">Introduce tu nombre:</label>
        <input type="text" id="playerNameJoin" required>
        <button onclick="toggleForm()">Volver</button>
        <button type="submit">Aceptar</button>
    </form>

    <form id="createForm" onsubmit="createNewRoom(event)">
        <label for="playerNameCreate">Nombre del Jugador:</label>
        <input type="text" id="playerNameCreate" required>
        <button type="submit">Crear Juego</button>
    </form>

    <button onclick="createNewRoom()">Crear Nuevo Juego</button>

    <script>
        // Función para cargar la lista de juegos al cargar la página
        window.onload = function() {
            loadRoomsList();
        };

        // Función para cargar la lista de juegos desde el servidor
        function loadRoomsList() {
            fetch('http://localhost:3000/api/activeRooms')
                .then(response => response.json())
                .then(data => {
                    const roomsList = document.getElementById('roomsList');

                    // Limpiar la lista antes de agregar nuevos elementos
                    roomsList.innerHTML = '';

                    data.forEach(room => {
                        const listItem = document.createElement('li');
                        listItem.innerHTML = `${room.players.join(' vs ')} - ${room.status}`;
                        
                        const joinButton = document.createElement('button');
                        joinButton.textContent = 'Unirse';
                        joinButton.addEventListener('click', () => {
                        toggleForm();
                        const roomId = document.getElementById('roomId');
                        roomId.value=room.roomId
                        });

                        listItem.appendChild(joinButton);
                        roomsList.appendChild(listItem);
                    });
                })
                .catch(error => console.error('Error al cargar la lista de juegos:', error));
        }

        function toggleForm() {
            const joinForm = document.getElementById('joinForm');
            const roomsList = document.getElementById('roomsList');

            joinForm.style.display = joinForm.style.display === 'none' ? 'block' : 'none';
            roomsList.style.display = roomsList.style.display === 'none' ? 'block' : 'none';
        }

        // ... (otro código)

        // Función para unirse a un juego con el nombre del jugador
        function joinRoom(event) {
            event.preventDefault();
            const roomId = document.getElementById('roomId').value;
            const playerName = document.getElementById('playerNameJoin').value;

            window.location.href = `./TicTacToe/index.html?roomId=${roomId}&playerName=${playerName}`;
        }

        // Función para crear un nuevo juego con el nombre del jugador
        function createNewRoom(event) {
            event.preventDefault();
            const playerName = document.getElementById('playerNameCreate').value;

            // Realiza una solicitud POST al servidor para crear una nueva partida
            fetch('http://localhost:3000/api/createRoom', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ playerName }),
            })
            .then(response => response.json())
            .then(data => {
                // Redirige al usuario a la página del juego con el ID obtenido
                console.log(data)
                window.location.href = `./TicTacToe/index.html?roomId=${data.roomId}&playerName=${playerName}`;
            })
            .catch(error => console.error('Error al crear un nuevo juego:', error));
        }
    </script>
</body>
</html>